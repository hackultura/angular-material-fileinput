!function(e){"use strict";var i=e.module("lfNgMdFileInput",["ngMaterial","ngMdIcons"]);i.filter("lfTrusted",["$sce",function(e){return function(i){return e.trustAsResourceUrl(i)}}]),i.directive("lfNgMdFileInput",["$q","$compile",function(i,l){return{restrict:"E",template:['<div class="lf-ng-md-file-input">','<div class="lf-ng-md-file-input-preview-container" ng-class="{\'disabled\':isDisabled}" ng-show="isDrag || (isPreview && !isFilesNull)">','<div class="close lf-ng-md-file-input-x" ng-click="removeAllFiles($event)" ng-hide="isFilesNull" >&times;</div>','<div class="lf-ng-md-file-input-drag">','<div layout="row" layout-align="center center" class="lf-ng-md-file-input-drag-text-container" ng-show="isFilesNull && isDrag">','<div class="lf-ng-md-file-input-drag-text">Drag & drop files here ...</div>',"</div>",'<div class="lf-ng-md-file-input-thumbnails">',"</div>",'<div class="clearfix" style="clear:both"></div>',"</div>","</div>",'<div class="lf-ng-md-file-input-container" >','<div tabindex="-1" class="lf-ng-md-file-input-caption" ng-class="{\'disabled\':isDisabled}">','<!--<span class="file-caption-ellipsis">&hellip;</span>-->','<div class="lf-ng-md-file-input-caption-text" ng-hide="isFilesNull">','<ng-md-icon icon="insert_drive_file" size="24" style="fill:black; "></ng-md-icon>',"{{strCaption}}","</div>",'<div class="lf-ng-md-file-input-caption-text-default" ng-show="isFilesNull">'," {{strCaptionPlaceholder}}","</div>","</div>",'<div class="" style="position:relative;display:table-cell;width:1%;white-space:nowrap;">','<md-button type="button" ng-disabled="isDisabled" ng-hide="isFilesNull" ng-click="removeAllFiles()" class="md-raised lf-ng-md-file-input-button lf-ng-md-file-input-button-remove">','<ng-md-icon icon="delete" size="24" style="fill:black;"></ng-md-icon>'," Remove","</md-button><!--",'--><md-button type="button" ng-disabled="isDisabled" class="md-raised md-primary lf-ng-md-file-input-button lf-ng-md-file-input-button-brower">','<ng-md-icon icon="folder_open" size="24" style="fill:white;"></ng-md-icon>'," Browse",'<input type="file" accept="{{accept}}" ng-disabled="isDisabled" class="lf-ng-md-file-input-tag" onchange="angular.element(this).scope().onFileChanged(this)"/>',"</md-button>","</div>","</div>","</div>"].join(""),replace:!0,scope:{lfFiles:"=?",lfPlaceholder:"@?",accept:"@?",ngDisabled:"=?"},link:function(n,t,a){var s=e.element(t[0].querySelector(".lf-ng-md-file-input-tag")),r=e.element(t[0].querySelector(".lf-ng-md-file-input-drag")),o=e.element(t[0].querySelector(".lf-ng-md-file-input-thumbnails"));n.isPreview=!1,n.isDrag=!1,n.isMutiple=!1,"preview"in a&&(n.isPreview=!0),"drag"in a&&(n.isDrag=!0),"multiple"in a?(s.attr("multiple","multiple"),n.isMutiple=!0):s.removeAttr("multiple"),n.isDisabled=!1,e.isDefined(a.ngDisabled)&&n.$watch(function(){return n.ngDisabled},function(e){n.isDisabled=e}),n.accept=n.accept||"",n.lfFiles=[],n.isFilesNull=!0,n.strCaption="",n.strCaptionPlaceholder="Select file",n.lfPlaceholder&&(n.strCaptionPlaceholder=n.lfPlaceholder),r.bind("dragover",function(e){e.stopPropagation(),e.preventDefault(),!n.isDisabled&&n.isDrag&&r.addClass("lf-ng-md-file-input-drag-hover")}),r.bind("dragleave",function(e){e.stopPropagation(),e.preventDefault(),!n.isDisabled&&n.isDrag&&r.removeClass("lf-ng-md-file-input-drag-hover")}),r.bind("drop",function(e){if(e.stopPropagation(),e.preventDefault(),!n.isDisabled&&n.isDrag){r.removeClass("lf-ng-md-file-input-drag-hover");var i=e.target.files||e.dataTransfer.files;if(!(i.length<=0)){var l=n.lfFiles.map(function(e){return e.lfFileName}),t=new RegExp(n.accept,"i");if(n.isMutiple)for(var a=0;a<i.length;a++){var s=i[a];s.type.match(t)&&-1==l.indexOf(s.name)&&setTimeout(d(s),100*a)}else for(var a=0;a<i.length;a++){var s=i[a];if(s.type.match(t)&&-1==l.indexOf(s.name)){n.removeAllFiles(),setTimeout(d(s),100*a);break}}}}}),n.removeAllFiles=function(e){n.isDisabled||(n.lfFiles=[],o.empty(),f())},n.removeFileByName=function(i){n.isDisabled||(n.lfFiles.every(function(e,l){return e.lfFileName==i?(n.lfFiles.splice(l,1),!1):!0}),event&&e.element(event.target).parent().remove(),f())},n.onFileChanged=function(e){var i=e.files,l=n.lfFiles.map(function(e){return e.lfFileName});if(!(i.length<=0)){if(n.isMutiple)for(var t=0;t<i.length;t++){var a=i[t],r=1;-1==l.indexOf(a.name)&&(setTimeout(d(a),100*r),r++)}else for(var t=0;t<i.length;t++){var a=i[t];if(-1==l.indexOf(a.name)){console.log("remove"),n.removeAllFiles(),setTimeout(d(a),100);break}}s.val("")}};var d=function(i){g(i).then(function(t){var a=i,s=i.name,r=i.type,d=c(i),u=window.URL.createObjectURL(i);n.lfFiles.push({lfFile:a,lfFileName:s,lfDataUrl:u}),console.log(n.lfFiles);var m=e.element('<div class="lf-ng-md-file-input-frame"></div>'),p=e.element('<div class="lf-ng-md-file-input-x" ng-click="removeFileByName(\''+i.name+"',$event)\">&times;</div>"),g="";g="image"==d?'<img src="'+u+'" >':"video"==d?["<video controls>",'<source src="'+u+'" type="'+r+'">',"</video>"].join(""):"audio"==d?["<audio controls>",'<source src="'+u+'" type="'+r+'">',"</audio>"].join(""):['<object data="'+u+'" type="'+r+'"><param name="movie" value="'+a.name+'" />','<div class="lf-ng-md-file-input-preview-default">','<ng-md-icon class="lf-ng-md-file-input-preview-icon" icon="attach_file" size="80"></ng-md-icon>',"</div>","</object>"].join("");var v=e.element(g),h=e.element('<div class="lf-ng-md-file-input-frame-footer"><div class="lf-ng-md-file-input-frame-caption">'+a.name+"</div></div>");m.append(p),m.append(v),m.append(h),l(m)(n),o.append(m),f()},function(e){},function(e){})},f=function(){1==n.lfFiles.length?(n.strCaption=""+n.lfFiles[0].lfFileName,n.isFilesNull=!1):n.lfFiles.length>1?(n.strCaption=""+n.lfFiles.length+" files selected",n.isFilesNull=!1):(n.strCaption="",n.isFilesNull=!0)},c=function(e){var i=e.type,l=e.name;return u(i,l)?"image":m(i,l)?"video":p(i,l)?"audio":"object"},u=function(e,i){return e.match("image.*")||i.match(/\.(gif|png|jpe?g)$/i)?!0:!1},m=function(e,i){return e.match("video.*")||i.match(/\.(og?|mp4|webm|3gp)$/i)?!0:!1},p=function(e,i){return e.match("audio.*")||i.match(/\.(ogg|mp3|wav)$/i)?!0:!1},g=function(e,l){var n=i.defer(),t=new FileReader;return t.onloadstart=function(){n.notify(0)},t.onload=function(e){},t.onloadend=function(e){n.resolve({index:l,result:t.result})},t.onerror=function(e){n.reject(t.result)},t.onprogress=function(e){n.notify(e.loaded/e.total)},t.readAsArrayBuffer(e),n.promise}}}}])}(window.angular);